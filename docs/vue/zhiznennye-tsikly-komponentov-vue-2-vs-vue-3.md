Когда вы создаёте компонент Vue, он проходит через серию этапов:

1. Создание (инициализация данных, методов и реактивности)
2. Монтирование (создание DOM-элементов)
3. Обновления, когда изменяется реактивное состояние
4. Размонтирование / уничтожение компонента

Vue даёт “крючки” (hooks), которые позволяют выполнить свой код в определённые моменты жизненного цикла — например, когда компонент только создан, когда DOM уже в документе, когда обновился, или сразу перед удалением.

---

## Основные хуки во Vue 2 (Options API)

Вот порядок и описание ключевых хуков, во Vue 2 (Options API) — как и где можно использовать.

| Хук             | Когда вызывается / что уже готово                                                                                                             | Что можно делать                                                                                                                            |
| --------------- | --------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------- |
| `beforeCreate`  | сразу после создания экземпляра, ещё **нет** реактивности, нет `data`, методов и т.д.                                                         | установка “глобальных” параметров, логирование, что компонент создаётся; нельзя обращаться к `this.data`/методам/реактивности — их ещё нет. |
| `created`       | после `beforeCreate`, когда реактивность установлена — `data`, `computed`, `methods`, `watchers` готовы; но ещё нет DOM (еще не смонтировано) | можно делать запросы, инициализировать данные, но нельзя обращаться к DOM (`this.$el` может быть undefined)                                 |
| `beforeMount`   | перед тем, как Vue вставит компонент в DOM в первый раз; шаблон скомпилирован, реактивность готова, но ещё нет элементов в документе          | можно подготовить что-то перед “физическим” отображением, но DOM-элементы ещё не существуют                                                 |
| `mounted`       | после того, как компонент **смонтирован**: DOM-элементы созданы и вставлены в родительский контейнер                                          | доступ к DOM через `this.$el`, `refs`; запуск сторонних библиотек, подписки, эффекты, таймеры и др.                                         |
| `beforeUpdate`  | когда реактивные данные изменились, перед тем как Vue обновит DOM (виртуальный DOM + патчинг)                                                 | можно посмотреть текущее состояние DOM / “до изменений” — например, сохранять положение прокрутки или выполнять расчёты до обновления       |
| `updated`       | после того, как изменения реактивного состояния уже применены, DOM обновлён                                                                   | можно реагировать на изменения DOM, но не изменять состояние компонента **(чтобы не вызвать бесконечный цикл)**                             |
| `beforeDestroy` | (Vue 2) перед удалением компонента, до того как будет размонтирован, DOM ещё существует                                                       | очистка: остановка таймеров, удаление слушателей и др.                                                                                      |
| `destroyed`     | (Vue 2) когда компонент уже уничтожен, DOM удалён, наблюдатели/реактивность отключены                                                         | окончательная очистка, освобождение ресурсов                                                                                                |

Дополнительные хуки во Vue 2:

- `activated` / `deactivated` — для компонентов, обёрнутых в `<keep-alive>`. Когда компонент “активируется” из кеша или “деактивируется”.
- `errorCaptured` — когда ошибка “всплывает” от потомка компонента, её можно поймать и обработать

---

## Что изменилось / добавилось в Vue 3

Vue 3 сохраняет большинство тех же стадий, особенно если использовать **Options API** — хуки работают так же, как во Vue 2.

Но есть важные отличия:

| Отличие                           | Описание                                                                                                                                                                                            |
| --------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `setup()`                         | В Vue 3 + Composition API — новый способ “создания” компонента. Код, который раньше писали в `beforeCreate` / `created`, теперь часто помещают в `setup()`. |
| Переименование хуков “разрушения” | Во Vue 2 были `beforeDestroy` / `destroyed`; в Vue 3 они стали `beforeUnmount` / `unmounted`.                                                               |
| Хуки Composition API              | Вместо методов опций (`mounted`, `updated` и др.), используются `onMounted()`, `onUpdated()`, `onBeforeUnmount()`, `onUnmounted()` и др. Эти хуки импортируются из `vue` внутри `setup()`.          |
| Хуки “KeepAlive”                  | `activated` и `deactivated` сохраняются и в Vue 3, работают аналогично при использовании `<KeepAlive>` компонента.                                                                                  |
| Хуки ошибок                       | `errorCaptured` есть и в Vue 3; позволяет ловить ошибки в дочерних компонентах.                                                                                                                     |

---

---

Вот несколько примеров Vue-компонентов, демонстрирующих все основные хуки жизненного цикла (Options API и Composition API), + примеры того, что делать и чего избегать. Всё в MD-формате, экранировано.

---

## Пример: компонент со всеми хуками (Options API)

```vue
<template>
	<div>
		<p>{{ counter }}</p>
		<button @click="increment">Increment</button>
	</div>
</template>

<script>
export default {
	data() {
		return {
			counter: 0,
		};
	},
	beforeCreate() {
		console.log("beforeCreate: data и методы ещё не настроены");
	},
	created() {
		console.log("created: data и методы уже есть, но DOM ещё не монтирован");
	},
	beforeMount() {
		console.log("beforeMount: готовимся к монтированию (DOM ещё нет)");
	},
	mounted() {
		console.log("mounted: компонент уже в DOM, можно работать с this.$el / $refs");
	},
	beforeUpdate() {
		console.log("beforeUpdate: реактивные данные изменились, DOM скоро обновится");
	},
	updated() {
		console.log("updated: DOM обновился, можно читать новые значения");
	},
	beforeDestroy() {
		// Vue 2
		console.log("beforeDestroy: компонент скоро будет уничтожен, но всё ещё в DOM");
	},
	destroyed() {
		// Vue 2
		console.log("destroyed: компонент уничтожен, DOM удалён, подписки чистятся");
	},
};
</script>
```

---

## Пример: компонент со всеми хуками (Vue 3 Composition API)

```vue
<template>
	<div>
		<p ref="pEl">{{ message }} — {{ count }}</p>
		<button @click="increment">Increment</button>
	</div>
</template>

<script setup>
import {
	ref,
	onBeforeMount,
	onMounted,
	onBeforeUpdate,
	onUpdated,
	onBeforeUnmount,
	onUnmounted,
	onActivated,
	onDeactivated,
	onErrorCaptured,
	onRenderTracked,
	onRenderTriggered,
	onServerPrefetch,
} from "vue";

const count = ref(0);
const message = ref("Hello Vue 3");

const increment = () => {
	count.value++;
};

// Пример serverPrefetch — работает при SSR
onServerPrefetch(async () => {
	console.log("onServerPrefetch: data можно загрузить на сервере");
});

// Монтирование
onBeforeMount(() => {
	console.log("onBeforeMount: перед монтированием");
});
onMounted(() => {
	console.log("onMounted: компонент в DOM");
});

// Обновления
onBeforeUpdate(() => {
	console.log("onBeforeUpdate: до обновления DOM");
});
onUpdated(() => {
	console.log("onUpdated: DOM обновился, count =", count.value);
});

// KeepAlive / кеширование
onActivated(() => {
	console.log("onActivated: компонент активирован из кеша");
});
onDeactivated(() => {
	console.log("onDeactivated: компонент деактивирован (в кеше)");
	// (но не удалён из DOM)
});

// Уничтожение
onBeforeUnmount(() => {
	console.log("onBeforeUnmount: перед удалением, можно очистить подписки / таймеры");
});
onUnmounted(() => {
	console.log("onUnmounted: компонент удалён, DOM уже нет");
});

// Отлов ошибок
onErrorCaptured((err, instance, info) => {
	console.error("onErrorCaptured:", err, "info:", info);
	// вернуть false, чтобы ошибка дальше не всплывала
	return false;
});

// Для отладки реактивности / трассировки
onRenderTracked((event) => {
	console.log("onRenderTracked:", event);
});
onRenderTriggered((event) => {
	console.log("onRenderTriggered:", event);
});
</script>
```

---

## Что из этих хуков — полезно и когда использовать

| Хук                                                                | Когда использовать / примеры                                                                                         |
| ------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------- |
| `beforeCreate` / `created` (Options API) / `setup()` (Composition) | начальная инициализация: установка данных, проверок, возможно загрузка данных (если не зависит от DOM)               |
| `beforeMount` / `onBeforeMount`                                    | что-то, что нужно сделать прямо перед тем, как компонент “появится” в DOM, но элемент DOM ещё недоступен             |
| `mounted` / `onMounted`                                            | доступ к DOM через `$el`, `refs`; запуск сторонних библиотек, таймеров, запросов, которые требуют DOM                |
| `beforeUpdate` / `onBeforeUpdate`                                  | посмотреть текущее состояние перед изменением DOM; сохранить размеры / позиции перед обновлением                     |
| `updated` / `onUpdated`                                            | после изменения DOM: читать из `refs` / DOM, запуск логики, завязанной на отображение                                |
| `onActivated` / `activated` и `onDeactivated` / `deactivated`      | при использовании `<KeepAlive>`: когда компонент “спит” в кеше и становится активен / неактивен                      |
| `onBeforeUnmount` / `beforeDestroy` и `onUnmounted` / `destroyed`  | очистка: удаление слушателей, остановка таймеров, отмена сетевых запросов, освобождение ресурсов                     |
| `onErrorCaptured` / `errorCaptured`                                | отлов ошибок внутри дочерних компонентов, логирование, показы пользовательского сообщения                            |
| `onRenderTracked` / `onRenderTriggered`                            | для дебага, чтобы понять, какие реактивные зависимости отслеживаются / вызывают повторный рендер — чаще в dev-режиме |
| `onServerPrefetch`                                                 | SSR: предзагрузка данных перед серверным рендером, чтобы страница была готова                                        |

---

## Чит-шит (таблица основных хуков)

| Стадия          | Vue 2 (Options API)           | Vue 3 (Options API)                     | Vue 3 (Composition API)                          |
| --------------- | ----------------------------- | --------------------------------------- | ------------------------------------------------ |
| Создание        | `beforeCreate` → `created`    | те же                                   | `setup()` ≈ начало (вместо beforeCreate/created) |
| Монтирование    | `beforeMount` → `mounted`     | те же                                   | `onBeforeMount()` → `onMounted()`                |
| Обновление      | `beforeUpdate` → `updated`    | те же                                   | `onBeforeUpdate()` → `onUpdated()`               |
| Размонтирование | `beforeDestroy` → `destroyed` | renamed → `beforeUnmount` → `unmounted` | `onBeforeUnmount()` → `onUnmounted()`            |
| KeepAlive       | `activated`, `deactivated`    | те же                                   | `onActivated()`, `onDeactivated()`               |
| Ошибки          | `errorCaptured`               | те же                                   | `onErrorCaptured()`                              |
|                 |                               |                                         |                                                  |

---
