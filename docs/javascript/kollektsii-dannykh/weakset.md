# ðŸ§  Ð§Ñ‚Ð¾ Ñ‚Ð°ÐºÐ¾Ðµ `WeakSet` Ð² JavaScript

**`WeakSet`** â€” ÑÑ‚Ð¾ ÑÐ¿ÐµÑ†Ð¸Ð°Ð»ÑŒÐ½Ð°Ñ ÐºÐ¾Ð»Ð»ÐµÐºÑ†Ð¸Ñ Ð´Ð»Ñ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ **ÑÐ»Ð°Ð±Ñ‹Ñ… ÑÑÑ‹Ð»Ð¾Ðº** Ð½Ð° Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ.
Ð§Ð°Ñ‰Ðµ Ð²ÑÐµÐ³Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‚ Ð¾Ð±ÑŠÐµÐºÑ‚Ñ‹: ÐµÑÐ»Ð¸ Ð¾Ð±ÑŠÐµÐºÑ‚ Ð±Ð¾Ð»ÑŒÑˆÐµ Ð½Ð¸Ð³Ð´Ðµ Ð½Ðµ Ð½ÑƒÐ¶ÐµÐ½, ÑÐ±Ð¾Ñ€Ñ‰Ð¸Ðº Ð¼ÑƒÑÐ¾Ñ€Ð° Ð¼Ð¾Ð¶ÐµÑ‚ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ ÐµÐ³Ð¾ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸, Ð´Ð°Ð¶Ðµ ÐµÑÐ»Ð¸ Ð¾Ð½ Ð±Ñ‹Ð» Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ Ð² `WeakSet`.

Ð˜Ð´ÐµÑ Ð¿Ñ€Ð¾ÑÑ‚Ð°Ñ:

- `Set` Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ "ÑÐ¸Ð»ÑŒÐ½Ð¾" (Ð¾Ð½Ð¸ Ð¾ÑÑ‚Ð°ÑŽÑ‚ÑÑ, Ð¿Ð¾ÐºÐ° Ñ‚Ñ‹ Ð¸Ñ… Ð½Ðµ ÑƒÐ´Ð°Ð»Ð¸ÑˆÑŒ).
- `WeakSet` Ð½Ðµ Ð¼ÐµÑˆÐ°ÐµÑ‚ GC Ð¾Ñ‡Ð¸Ñ‰Ð°Ñ‚ÑŒ Ð¿Ð°Ð¼ÑÑ‚ÑŒ.

---

## ðŸ“Œ ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ð¾ÑÐ¾Ð±ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸

| Ð¡Ð²Ð¾Ð¹ÑÑ‚Ð²Ð¾ | `WeakSet` |
| --- | --- |
| Ð§Ñ‚Ð¾ Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ | Ð¾Ð±ÑŠÐµÐºÑ‚Ñ‹ (Ð¸ non-registered ÑÐ¸Ð¼Ð²Ð¾Ð»Ñ‹) |
| Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ | Ð´Ð°, Ð´ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ‚Ñ‹ Ð½Ðµ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÑŽÑ‚ÑÑ |
| ÐŸÐ¾Ñ€ÑÐ´Ð¾Ðº | Ð½Ðµ Ð³Ð°Ñ€Ð°Ð½Ñ‚Ð¸Ñ€ÑƒÐµÑ‚ÑÑ, Ð¿ÐµÑ€ÐµÐ±Ð¾Ñ€Ð° Ð½ÐµÑ‚ |
| Ð Ð°Ð·Ð¼ÐµÑ€ | Ð½ÐµÑ‚ `.size` |
| Ð˜Ñ‚ÐµÑ€Ð°Ñ†Ð¸Ñ | Ð½ÐµÑ‚ `for...of`, `forEach`, `values`, `keys` |
| GC | ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ñ‹ Ð¼Ð¾Ð³ÑƒÑ‚ ÑƒÐ´Ð°Ð»ÑÑ‚ÑŒÑÑ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ |

---

## âš™ ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ð¼ÐµÑ‚Ð¾Ð´Ñ‹

Ð£ `WeakSet` Ð²ÑÐµÐ³Ð¾ 3 Ð¼ÐµÑ‚Ð¾Ð´Ð°:

| ÐœÐµÑ‚Ð¾Ð´ | Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°ÐµÑ‚ |
| --- | --- |
| `add(value)` | Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÑ‚ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð² ÐºÐ¾Ð»Ð»ÐµÐºÑ†Ð¸ÑŽ |
| `has(value)` | Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ðµ |
| `delete(value)` | ÑƒÐ´Ð°Ð»ÑÐµÑ‚ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ |

ÐŸÑ€Ð¸Ð¼ÐµÑ€:

```js
const ws = new WeakSet();

const user = { id: 1 };
ws.add(user);

console.log(ws.has(user)); // true
ws.delete(user);
console.log(ws.has(user)); // false
```

---

## ðŸ” ÐŸÐ¾Ñ‡ÐµÐ¼Ñƒ Ð½ÐµÑ‚ `.size` Ð¸ Ð¿ÐµÑ€ÐµÐ±Ð¾Ñ€Ð°

Ð£ `WeakSet` Ð½ÐµÐ»ÑŒÐ·Ñ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ Ð¿ÐµÑ€ÐµÑ‡Ð¸ÑÐ»Ð¸Ñ‚ÑŒ Ð²ÑÐµ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ñ‹, Ð¿Ð¾Ñ‚Ð¾Ð¼Ñƒ Ñ‡Ñ‚Ð¾ Ñ‡Ð°ÑÑ‚ÑŒ Ð¸Ð· Ð½Ð¸Ñ… Ð¼Ð¾Ð¶ÐµÑ‚ Ð¸ÑÑ‡ÐµÐ·Ð½ÑƒÑ‚ÑŒ Ð² Ð»ÑŽÐ±Ð¾Ð¹ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ Ð¸Ð·-Ð·Ð° garbage collector.

Ð˜Ð¼ÐµÐ½Ð½Ð¾ Ð¿Ð¾ÑÑ‚Ð¾Ð¼Ñƒ Ñƒ `WeakSet` Ð½ÐµÑ‚:

- `size`
- `forEach`
- `keys`/`values`/`entries`
- `for...of`

---

## ðŸ§  ÐšÐ¾Ð³Ð´Ð° `WeakSet` Ð¿Ð¾Ð»ÐµÐ·ÐµÐ½

### 1) ÐžÑ‚Ð¼ÐµÑ‡Ð°Ñ‚ÑŒ "ÑƒÐ¶Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð½Ð½Ñ‹Ðµ" Ð¾Ð±ÑŠÐµÐºÑ‚Ñ‹

```js
const processed = new WeakSet();

function processNode(node) {
	if (processed.has(node)) {
		return;
	}

	processed.add(node);
	// Ñ‚ÑÐ¶ÐµÐ»Ð°Ñ Ð»Ð¾Ð³Ð¸ÐºÐ°
}
```

ÐŸÐ¾Ð»ÐµÐ·Ð½Ð¾, ÐºÐ¾Ð³Ð´Ð° Ð¾Ð±ÑŠÐµÐºÑ‚ Ð¶Ð¸Ð²ÐµÑ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ð¾ÐºÐ° Ð½ÑƒÐ¶ÐµÐ½ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸ÑŽ. ÐÐµ Ð½ÑƒÐ¶Ð½Ð¾ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ Ñ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ ÐºÐ¾Ð»Ð»ÐµÐºÑ†Ð¸ÑŽ.

### 2) Ð’Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¼ÐµÑ‚ÐºÐ¸ Ð´Ð»Ñ DOM-ÑƒÐ·Ð»Ð¾Ð²

```js
const bound = new WeakSet();

function bindClick(el) {
	if (bound.has(el)) {
		return;
	}

	el.addEventListener("click", () => {
		console.log("clicked");
	});

	bound.add(el);
}
```

ÐšÐ¾Ð³Ð´Ð° ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑÑ Ð¸Ð· DOM Ð¸ Ð½Ð° Ð½ÐµÐ³Ð¾ Ð½Ðµ Ð¾ÑÑ‚Ð°Ð½ÐµÑ‚ÑÑ ÑÑÑ‹Ð»Ð¾Ðº, GC ÑÐ¼Ð¾Ð¶ÐµÑ‚ Ð¾Ñ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ Ð¸ Ð·Ð°Ð¿Ð¸ÑÑŒ Ð² `WeakSet`.

---

## ðŸ“Š Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ `Set` Ð¸ `WeakSet`

| ÐšÑ€Ð¸Ñ‚ÐµÑ€Ð¸Ð¹ | `Set` | `WeakSet` |
| --- | --- | --- |
| Ð¢Ð¸Ð¿ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ð¹ | Ð»ÑŽÐ±Ñ‹Ðµ | Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¾Ð±ÑŠÐµÐºÑ‚Ñ‹/ÑÐ¿ÐµÑ†. ÑÐ¸Ð¼Ð²Ð¾Ð»Ñ‹ |
| Ð˜Ñ‚ÐµÑ€Ð°Ñ†Ð¸Ñ | ÐµÑÑ‚ÑŒ | Ð½ÐµÑ‚ |
| `.size` | ÐµÑÑ‚ÑŒ | Ð½ÐµÑ‚ |
| ÐšÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŒ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ | Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ | Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ñ‡ÐµÑ€ÐµÐ· GC |
| Ð¢Ð¸Ð¿Ð¸Ñ‡Ð½Ñ‹Ð¹ ÐºÐµÐ¹Ñ | ÑÐ¿Ð¸ÑÐ¾Ðº ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ð¹ | Ð¼Ð°Ñ€ÐºÐµÑ€Ñ‹ Ð´Ð»Ñ Ð¾Ð±ÑŠÐµÐºÑ‚Ð¾Ð² Ð±ÐµÐ· ÑƒÑ‚ÐµÑ‡ÐµÐº Ð¿Ð°Ð¼ÑÑ‚Ð¸ |

---

## âŒ ÐšÐ¾Ð³Ð´Ð° `WeakSet` Ð½Ðµ Ð¿Ð¾Ð´Ñ…Ð¾Ð´Ð¸Ñ‚

- Ð½ÑƒÐ¶Ð½Ð¾ Ð¿ÐµÑ€ÐµÐ±Ñ€Ð°Ñ‚ÑŒ Ð²ÑÐµ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ñ‹;
- Ð½ÑƒÐ¶Ð½Ð¾ Ð·Ð½Ð°Ñ‚ÑŒ Ñ‚Ð¾Ñ‡Ð½Ñ‹Ð¹ Ñ€Ð°Ð·Ð¼ÐµÑ€ ÐºÐ¾Ð»Ð»ÐµÐºÑ†Ð¸Ð¸;
- Ð½ÑƒÐ¶Ð½Ð¾ Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð¼Ð¸Ñ‚Ð¸Ð²Ñ‹ (`string`, `number`, `boolean`, `null`, `undefined`, `bigint`).

Ð’ ÑÑ‚Ð¸Ñ… ÑÐ»ÑƒÑ‡Ð°ÑÑ… Ð»ÑƒÑ‡ÑˆÐµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð¾Ð±Ñ‹Ñ‡Ð½Ñ‹Ð¹ `Set`.

---

## âœ… Ð˜Ñ‚Ð¾Ð³

`WeakSet` â€” ÑÑ‚Ð¾ ÐºÐ¾Ð»Ð»ÐµÐºÑ†Ð¸Ñ Ð´Ð»Ñ **Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… ÑÐ²ÑÐ·ÐµÐ¹ Ñ Ð¾Ð±ÑŠÐµÐºÑ‚Ð°Ð¼Ð¸**, Ð³Ð´Ðµ Ð²Ð°Ð¶Ð½Ð¾ Ð½Ðµ Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ð¿Ð°Ð¼ÑÑ‚ÑŒ Ð»Ð¸ÑˆÐ½Ð¸Ð¹ Ñ€Ð°Ð·.

Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ `WeakSet`, ÐºÐ¾Ð³Ð´Ð° Ð½ÑƒÐ¶Ð½Ð¾:

- Ð¿Ð¾Ð¼ÐµÑ‡Ð°Ñ‚ÑŒ Ð¾Ð±ÑŠÐµÐºÑ‚Ñ‹ ÐºÐ°Ðº "Ð²Ð¸Ð´ÐµÐ»/Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð»";
- Ð¸Ð·Ð±ÐµÐ¶Ð°Ñ‚ÑŒ Ñ€ÑƒÑ‡Ð½Ð¾Ð¹ Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ¸ ÐºÐ¾Ð»Ð»ÐµÐºÑ†Ð¸Ð¸;
- ÑÐ½Ð¸Ð·Ð¸Ñ‚ÑŒ Ñ€Ð¸ÑÐº ÑƒÑ‚ÐµÑ‡ÐµÐº Ð¿Ð°Ð¼ÑÑ‚Ð¸ Ð² long-running Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸ÑÑ….

---

## ÐžÑ„Ð¸Ñ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸ÐºÐ¸

- MDN: `WeakSet`  
  https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakSet
- MDN: Keyed collections  
  https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Keyed_collections
- ECMAScript specification: WeakSet Objects  
  https://tc39.es/ecma262/#sec-weakset-objects

---

> [!tip] Ð¡Ð²ÑÐ·Ð°Ð½Ð½Ñ‹Ðµ Ñ‚ÐµÐ¼Ñ‹
>
> - [Map](/javascript/kollektsii-dannykh/map)
> - [Set](/javascript/kollektsii-dannykh/set)
> - [WeakMap](/javascript/kollektsii-dannykh/weakmap)

